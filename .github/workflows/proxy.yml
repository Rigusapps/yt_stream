name: Proxy Listener (repository_dispatch)

on:
  repository_dispatch:
    types: [stream_trigger]

jobs:
  proxy:
    runs-on: ubuntu-latest
    steps:
      - name: Show payload
        run: echo "Payload: ${{ toJson(github.event.client_payload) }}"

     - name: Trigger stream using dispatch
  env:
    PAYLOAD: ${{ toJson(github.event.client_payload) }}
  run: |
    curl -s -X POST \
      -H "Authorization: token ${{ secrets.GH_PAT }}" \
      -H "Accept: application/vnd.github.v3+json" \
      -H "Content-Type: application/json" \
      -d "{\"event_type\":\"stream_trigger\",\"client_payload\":$PAYLOAD}" \
      https://api.github.com/repos/Rigusapps/yt_stream/dispatches
